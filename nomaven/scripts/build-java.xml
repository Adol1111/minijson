<?xml version="1.0"?>
<project name="MiniJsonJars" basedir=".." default="all">
    <property name="classesDir" value="java/classes"/>
    <property name="apidocDir" value="java/apidoc"/>
    <property name="output" value="java/jar"/>
    <property name="version" value="0.0.1"/>


	<target name="cleanMainClasses">
        <delete failonerror="false">
		    <fileset dir ="${classesDir}/main">
	            <include name="**" />
			</fileset>
		</delete>
    </target>
	<target name="cleanToolClasses">
        <delete failonerror="false">
		    <fileset dir ="${classesDir}/tool">
	            <include name="**" />
			</fileset>
		</delete>
    </target>
	<target name="cleanExtClasses">
        <delete failonerror="false">
		    <fileset dir ="${classesDir}/ext">
	            <include name="**" />
			</fileset>
		</delete>
    </target>
	<target name="cleanAllClasses" depends="cleanMainClasses, cleanToolClasses, cleanExtClasses">
        <delete failonerror="false">
		    <fileset dir ="${classesDir}/all">
	            <include name="**" />
			</fileset>
		</delete>
    </target>

	<target name="buildMainClasses" depends="cleanMainClasses">
        <javac srcdir="java/main"
                 destdir="${classesDir}/main"
                 debug="on"
                 source="1.7"
        />
    </target>
	<target name="buildToolClasses" depends="cleanToolClasses">
        <javac srcdir="java/tool"
                 destdir="${classesDir}/tool"
                 debug="on"
                 source="1.7"
        />
    </target>
	<target name="buildExtClasses" depends="cleanExtClasses">
        <javac srcdir="java/ext"
                 destdir="${classesDir}/ext"
                 debug="on"
                 source="1.7"
        />
    </target>
	<target name="buildAllClasses" depends="cleanAllClasses, buildMainClasses, buildToolClasses, buildExtClasses">
    </target>


	
    <target name="createOutputDir">
        <mkdir dir="${output}"/>
    </target>

    <target name="createCoreJar" depends="buildMainClasses, createOutputDir">
        <jar destfile="${output}/minijson-core-${version}.jar"
             basedir="${classesDir}/main"
             includes="org/minijson/**"
        />
    </target>
    <target name="createToolJar" depends="buildToolClasses, createOutputDir">
        <jar destfile="${output}/minijson-tool-${version}.jar"
             basedir="${classesDir}/tool"
             includes="org/minijson/tool/**"
        />
    </target>
	<!-- TBD -->
    <target name="createExtJar" depends="buildExtClasses, createOutputDir">
        <jar destfile="${output}/minijson-ext-${version}.jar"
             basedir="${classesDir}/ext"
             includes="org/minijson/ext/**"
        />
    </target>

	<target name="cleanAllClassesDir">
        <delete failonerror="false">
		    <fileset dir ="${classesDir}/all">
	            <include name="**" />
			</fileset>
		</delete>
    </target>
	<target name="copyAllClasses" depends="cleanAllClassesDir, buildAllClasses">
        <copy todir="${classesDir}/all" overwrite="true" flatten="false">
		    <fileset dir ="${classesDir}/main">
	            <include name="org/minijson/**" />
			</fileset>
		    <fileset dir ="${classesDir}/tool">
	            <include name="org/minijson/tool/**" />
			</fileset>
		</copy>
    </target>
    <target name="createAllJar" depends="copyAllClasses, createOutputDir">
        <jar destfile="${output}/minijson-all-${version}.jar"
             basedir="${classesDir}/all"
             includes="org/minijson/**"
        />
    </target>

	<target name="exportAllJars" depends="createCoreJar, createToolJar, createAllJar">
	
	</target>

	<target name="cleanApidocDir">
        <delete failonerror="false">
		    <fileset dir ="java/apidoc">
	            <include name="**" />
			</fileset>
		</delete>
    </target>
	<target name="apidoc" depends="createAllJar, cleanApidocDir" description="Generate javadoc for all modules">
	    <javadoc destdir="${apidocDir}">
    	    <packageset dir="java/main" defaultexcludes="yes">
    	      <include name="org/minijson/**"/>
    	    </packageset>
    	    <packageset dir="java/tool" defaultexcludes="yes">
    	      <include name="org/minijson/tool/**"/>
    	    </packageset>
    	    <packageset dir="java/ext" defaultexcludes="yes">
    	      <include name="org/minijson/ext/**"/>
     	    </packageset>
	        <doctitle><![CDATA[<h1>MiniJson Miminal JSON Parser - Generator</h1>]]></doctitle>
	        <bottom><![CDATA[<i>Copyright &#169; 2013 Harry Y. All Rights Reserved.</i>]]></bottom>
	    </javadoc>
	</target>

    <target name="all" depends="exportAllJars, apidoc" />
</project>
